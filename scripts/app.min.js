(function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};console.clear=function(){},console.log=function(){},$.extend({urlParams:function(a){var b,c,d,e,f,g;for(c=null,e=/\+/g,g=/([^&=]+)=?([^&]*)/g,b=function(a){return decodeURIComponent(a.replace(e," "))},f=a,d={};c=g.exec(f);)d[b(c[1])]=b(c[2]);return d}}),window.App={Models:{},Views:{},Collections:{},Router:{},Live:{},Config:{movieSearchURL:"https://www.google.com/uds/GwebSearch?key=notsupplied&v=1.0&safe=off&filter=0&gl=www.google.com&rsz=large&gss=.com&callback=?",movieDescriptionURL:"http://api.trakt.tv/movie/summary.json/515a27ba95fbd83f20690e5c22bceaff0dfbde7c",movieStreamsURL:"http://whateverorigin.org/get?url=https%3A//docs.google.com/get_video_info%3Fauthuser%3D%26docid%3D##VIDEOID##&callback=?",catalogURL:"https://yts.re/api/list.json",imdbSuggestionsURL:"http://sg.media-imdb.com/suggests/##FIRSTQUERYCHAR##/##QUERY##.json",searchQueryTemplate:"intitle:[##QUERY##] [mp4 | avi | mkv] -free -doc -pdf site:docs.google.com/file inurl:[preview OR edit]",$catalogContainerDOM:$("#catalogContainer"),$movieTemplateDOM:$("#movieTemplate"),$searchTemplateDOM:$("#searchTemplate"),$indexTemplateDOM:$("#indexTemplate"),$searchFieldDOM:$("#magic_field"),$playerTemplateDOM:$("#playerTemplate")}},App.Models.CatalogMovieExtendedMetadata=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.urlRoot=App.Config.movieDescriptionURL,c.prototype.url=function(){var a;return a=this.urlRoot||"",""+a.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)+"?callback=?"},c.prototype.parse=function(a){var b;return a.poster300=null!=a&&null!=(b=a.poster)?b.replace(/(\.(\w+))$/i,"-300$1"):void 0,a},c}(Backbone.Model),App.Models.CatalogMovie=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.initialize=function(a){return console.log("Models:CatalogMovie::Initing...",this),this.options=a||{},_.bindAll(this,"extendedData","setModelExtendedMetadataModelClass","extendedMetadataChanged")},c.prototype.extendedData=function(){var a;return a=new this.extendedMetadataModelClass({id:this.get("ImdbCode")}),_.bindAll(this,"extendedMetadataChanged"),this.listenTo(a,"change",this.extendedMetadataChanged),a.fetch()},c.prototype.setModelExtendedMetadataModelClass=function(a){return this.extendedMetadataModelClass=a,this.extendedData()},c.prototype.extendedMetadataChanged=function(a){return console.log("ModelsModels:CatalogMovieExtendedMetadata::extendedMetadataChanged",a),this.set("extendedMetadata",a)},c}(Backbone.Model),App.Views.CatalogMovie=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.initialize=function(a){return console.log("Views:CatalogMovie::Initing...",this),this.options=a||{},this.searchBarView=null!=a?a.searchBarView:void 0,_.bindAll(this,"template","renderUpdate","render","search","searchMovie"),this.listenTo(this.model,"change",this.renderUpdate)},c.prototype.events={"click .search":"searchMovie"},c.prototype.searchMovie=function(a){var b;return console.log("Views:CatalogMovie::searchMovie",this,arguments),null!=a&&a.preventDefault(),b=this.model.get("MovieTitleFiltered"),this.search(b)},c.prototype.search=function(a){return this.searchBarView.search(a)},c.prototype.template=function(){var a,b,c,d,e,f,g,h;return d=this.model.get("extendedMetadata"),console.log("Views.Model.::template em",d),f=null!=d?d.get("overview"):"Loading...",e=null!=d?d.get("people"):void 0,c="Loading...",null!=(null!=e?e.directors:void 0)&&(c="",g=e.directors.length>1?", ":"",_.each(e.directors,function(a,b){return b===e.directors.length-1&&(g=" "),c=""+c+a.name+g})),h=null!=d?d.get("trailer"):null,a=null!=d?d.get("poster300"):"",b={rating:this.model.get("MovieRating"),coverSrc:a,smallCoverSrc:this.model.get("CoverImage"),shortPlot:f,trailerURL:h,director:c,year:this.model.get("MovieYear"),title:this.model.get("MovieTitleFiltered")},_.template(App.Config.$movieTemplateDOM.html(),b)},c.prototype.renderUpdate=function(){return console.log("View:Movie::renderUpdate",this),this.$el.html($(this.template()).contents())},c.prototype.render=function(){return console.log("View:Movie::render",this),this.setElement($(this.template())),this},c}(Backbone.View),App.Collections.Catalog=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.initialize=function(){},c.prototype.url=App.Config.catalogURL,c.prototype.parse=function(a){var b;return console.log("Catalog response",a),b=a.MovieList,b=_.uniq(b,function(a){return console.log("Collections:Catalog::MovieParse IMDBcode",a.ImdbCode),a.ImdbCode}),_.map(b,function(a){var b;return a.MovieTitleFiltered=a.MovieTitle.replace(/(\(\w+\))|\d+(p)|HQ|(  )+|[.,_\-;]+/g,""),a.LargeCover=a.LargeCover||(null!=(b=a.CoverImage)?b.replace(/_med\./,"_large."):void 0)}),b},c}(Backbone.Collection),App.Views.Catalog=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.initialize=function(a){return console.log("Views:Catalog::Initing..",this),this.options=a||{},this.catalogCollection=null!=a?a.catalogCollection:void 0,this.catalogMovieViewClass=null!=a?a.catalogMovieViewClass:void 0,this.searchBarView=null!=a?a.searchBarView:void 0,this.extendedMetadataModelClass=null!=a?a.extendedMetadataModelClass:void 0,_.bindAll(this,"onAdd","onReset","render"),this.listenTo(this.catalogCollection,"add",this.onAdd),this.listenTo(this.catalogCollection,"reset",this.onReset),this.catalogCollection.fetch({reset:!0,data:{limit:50,sort:"seeds"},processData:!0})},c.prototype.events={"mouseenter .poster":"movieHoverOn","mouseleave .poster":"movieHoverOff"},c.prototype.movieHoverOff=function(){return this.$el.removeClass("hovering")},c.prototype.movieHoverOn=function(){return this.$el.addClass("hovering")},c.prototype.onAdd=function(a){return console.log("Views:Catalog::onAdd",a,this.options)},c.prototype.onReset=function(a){var b,c;return console.log("Views:Catalog::onReset",a),b=$(document.createDocumentFragment()),c=function(a){var c;return console.log("Views:Catalog::onReset movieEach",a),a.setModelExtendedMetadataModelClass(this.extendedMetadataModelClass),c=new this.catalogMovieViewClass({model:a,searchBarView:this.searchBarView}),b.append(c.render().el)},a.each(c,this),this.$el.html(b)},c}(Backbone.View),App.Models.SearchMovie=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.initialize=function(){return _.bindAll(this,"debugAllEvents"),this.fetch(),this.listenTo(this,"all",this.debugAllEvents)},c.prototype.debugAllEvents=function(){return console.log("Models:SearchMovie::Parse debug all events ",this.cid,arguments)},c.prototype.urlRoot=App.Config.movieStreamsURL,c.prototype.url=function(){var a;return a=this.urlRoot||"",(""+a.replace(/([^\/])$/,"$1")).replace("##VIDEOID##",this.id)},c.prototype.parse=function(a){var b,c;return null!=a.id?a:(b=$.urlParams(a.contents),console.log("Models:SearchMovie::Parse res "+this.videoID,a,this),"ok"!==b.status||null==b.url_encoded_fmt_stream_map||null==b.length_seconds||parseInt(b.length_seconds)<1800?(console.log("Models:SearchMovie::Parse res destroying "+this.videoID,this),void this.destroy()):(c=b.url_encoded_fmt_stream_map.split(","),c=_.map(c,function(a){return $.urlParams(a)}),a={streams:c,title:b.title,videoID:b.docid,length_seconds:b.length_seconds}))},c}(Backbone.Model),App.Collections.SearchMovies=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.model=App.Models.SearchMovie,c.prototype.initialize=function(){return _.bindAll(this,"search","fetch")},c.prototype.url=App.Config.movieSearchURL,c.prototype.search=function(a){var b;return console.log("Collections:SearchMovies::search ",a),!a||""===a||" "===a||a.length<3?void this.reset():(b=App.Config.searchQueryTemplate.replace("##QUERY##",a),this.query=a,this.fetch({data:{q:b}}))},c.prototype.parse=function(a){var b;return 200!==(null!=a?a.responseStatus:void 0)?void alert("Google API error: Quota limited?"+a.responseStatus):(a=_.filter(null!=a&&null!=(b=a.responseData)?b.results:void 0,function(a){var b,c,d,e,f,g,h,i,j;for(d="GwebSearch"===(null!=a?a.GsearchResultClass:void 0),h=/docs\.google\.com\/(?:a\/[^\/]+\/)?file\/d\/([A-Za-z0-9\-_]+)\/\w+/g,f=[],b=null;b=h.exec(a.url);)for(i=0,j=b.length;j>i;i++)e=b[i],f.push(e);return g=f[1],null!=a&&(a.videoID=g),c=null!=g,d&&c}),console.log("Collections:SearchMovies::Parse res",a),a=_.map(a,function(a){return a={id:null!=a?a.videoID:void 0}}),console.log("Collections:SearchMovies::Parse res",a),a)},c}(Backbone.Collection),App.Views.SearchMovie=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.id=function(){return"player_"+this.model.cid},c.prototype.className="playerWrapper",c.prototype.initialize=function(a){return this.options=a||{},console.log("Views:SearchMovie::Initing",this,a),_.bindAll(this,"render","template","reRender"),this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"change",this.reRender)},c.prototype.reRender=function(){return console.log("Views:SearchMovie::reRender",arguments),this.$el.addClass("loaded")},c.prototype.render=function(){var a,b,c;return console.log("Views:SearchMovie::Rending",this),null!=this.model.get("streams")&&(a=$(this.template()),this.$el.html(a),b=this.model.get("length_seconds")||0,c=videojs(this.$el.find("video")[0],null,function(){return console.log("Views:SearchMovie::Render Player Loaded",b,this),this.duration(b),this.trigger("timeupdate")}),c.resolutionSelector({default_res:"medium"}),c.on("durationchange",function(){this.trigger("timeupdate"),console.log("Views:SearchMovie::Render Player::Durationchange")})),this},c.prototype.template=function(){var a;return a={videoID:this.model.get("id"),title:this.model.get("title"),streams:this.model.get("streams"),elID:this.model.cid},_.template(App.Config.$playerTemplateDOM.html(),a)},c}(Backbone.View),App.Views.SearchResults=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.initialize=function(a){return console.log("Views:SearchResults::Initing...",this),this.options=a||{},this.searchBarModel=null!=a?a.searchBarModel:void 0,this.$dataEl=this.$el.find(".data"),_.bindAll(this,"queryChange","renderVideo","cleanVideo","search","onAll","onChange","onSync","onError","onRequest","onReset"),this.listenTo(this.searchBarModel,"change:query",this.queryChange),this.searchCollection=new App.Collections.SearchMovies,this.listenTo(this.searchCollection,"add",this.renderVideo),this.listenTo(this.searchCollection,"remove",this.cleanVideo),this.listenTo(this.searchCollection,"all",this.onAll),this.listenTo(this.searchCollection,"add remove change",this.onChange),this.listenTo(this.searchCollection,"reset",this.onReset),this.listenTo(this.searchCollection,"sync",this.onSync),this.listenTo(this.searchCollection,"error",this.onError),this.listenTo(this.searchCollection,"request",this.onRequest),this.throlledSearch=_.debounce(this.search,150)},c.prototype.onReset=function(){var a,b;return a=null!=(b=arguments[1])?b.previousModels:void 0,console.log("Views:SearchResults:onReset",arguments[1].previousModels),_.each(a,function(a){return function(b){return a.cleanVideo(b)}}(this)),this.onChange()},c.prototype.onError=function(){return console.log("Views:SearchResults::onError",arguments[0],arguments),this.$el.removeClass("loading")},c.prototype.onSync=function(){return console.log("Views:SearchResults::onSync",arguments[0],arguments),setTimeout(function(a){return function(){return a.$el.removeClass("loading")}}(this),200)},c.prototype.onRequest=function(){return console.log("Views:SearchResults::onRequest",arguments[0],arguments),arguments[0]===this.searchCollection?this.$el.addClass("loading"):void 0},c.prototype.onChange=function(){var a;return a=this.searchCollection.filter(function(a){return null!=a.get("streams")}).length,console.log("Views:SearchResults::onChange",arguments,a),a>=1?(this.$el.addClass("haveresults"),this.$el.removeClass("loading")):this.$el.removeClass("haveresults")},c.prototype.onAll=function(){return console.log("-- Views:SearchResults::onAll",arguments)},c.prototype.renderVideo=function(a){var b;return $("body, html").animate({scrollTop:0}),console.log("Views:SearchResults::renderVideo",arguments,a),b=new App.Views.SearchMovie({model:a}),this.$dataEl.append(b.render().el)},c.prototype.cleanVideo=function(a){var b;return console.log("Views:SearchResults::cleanVideo",a),b=this.$dataEl.find("#player_"+a.cid),null!=b&&b.addClass("unload"),setTimeout(function(){return function(){return null!=b?b.remove():void 0}}(this),1e3)},c.prototype.search=function(a){return console.log("Views:SearchResults::Search",a),this.searchCollection.search(a)},c.prototype.queryChange=function(a){var b;return b=a.get("query"),console.log("Views:SearchResults::queryChange",b),this.throlledSearch(b)},c}(Backbone.View),App.Models.SearchBar=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.initialize=function(){},c.prototype.defaults={query:"",placeholder:"What do you want to watch?"},c}(Backbone.Model),App.Views.SearchBar=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.initialize=function(a){return console.log("Views:Search::Initing...",this),this.options=a||{},_.bindAll(this,"search","template","render","autoComplete","onMagicFieldBlurs","mouseLeaveMagicField","mouseClickingMagicField"),this.render()},c.prototype.events={"submit form":"searchSubmit","mouseleave .magic_field":"mouseLeaveMagicField","click .magic_field":"mouseClickingMagicField"},c.prototype.bindings={".magic_field":"query"},c.prototype.mouseClickingMagicField=function(){return console.log("Views:SearchBar:mouseClickingMagicField",arguments),this.$magicField.removeClass("forcedBlur")},c.prototype.mouseLeaveMagicField=function(){return console.log("Views:SearchBar:mouseLeaveMagicField",arguments),this.$magicField.removeClass("forcedBlur")},c.prototype.searchSubmit=function(a){var b,c,d,e,f,g;return console.log("Views:SearchBar::searchSubmit"),null!=a&&a.preventDefault(),this.$magicField.addClass("forcedBlur"),this.$magicField.blur(),null!=(b=this.$magicField)&&null!=(c=b.autocomplete())&&c.clear(),null!=(d=this.$magicField)&&null!=(e=d.autocomplete())&&e.clearCache(),null!=(f=this.$magicField)&&null!=(g=f.autocomplete())?g.hide():void 0},c.prototype.template=function(){var a,b,c;return a={placeholder:null!=(b=this.model)?b.get("placeholder"):void 0,query:null!=(c=this.model)?c.get("query"):void 0},_.template(App.Config.$searchTemplateDOM.html(),a)},c.prototype.autoComplete=function(){var a,b;return a=function(a){return a=a.substr(0,6).replace(" ","_").toLowerCase()},b=this.search,this.$magicField.autocomplete({appendTo:this.$magicField.parent(),beforeRender:function(a){return console.log("Views:Search:AutoComplete::beforeRender",a),a.attr("style","")},transformResult:function(a){var b,c;return console.log("Views:SearchBar:AutoComplete::transformResult Res",a),b=_.map(a.d,function(a){return{value:a.l}}),c={suggestions:b}},jsonpCallback:function(b){return b=a(b),"imdb$"+b},width:"auto",triggerSelectOnValidInput:!1,maxHeight:"auto",serviceUrl:function(b){var c,d;return b=a(b),console.log("Views:SearchBar:AutoComplete::serviceUrl",b),d=App.Config.imdbSuggestionsURL,c=d.replace("##FIRSTQUERYCHAR##",b.charAt(0)),c=c.replace("##QUERY##",b)},onSelect:function(){return console.log("Views:SearchBar:AutoComplete::onSelect",arguments),b(this.value)},dataType:"jsonp"})},c.prototype.onMagicFieldBlurs=function(){var a,b,c,d;return console.log("Views:Search::onMagicFieldBlurs"),null!=(a=this.$magicField)&&null!=(b=a.autocomplete())&&b.hide(),null!=(c=this.$magicField)&&null!=(d=c.autocomplete())?d.clear():void 0},c.prototype.render=function(){return console.log("Views:Search::render",this),this.$el.html(this.template()),this.$magicField=$(".magic_field",this.$el),this.$magicField.blur(this.onMagicFieldBlurs),this.autoComplete(),this.stickit(),this},c.prototype.search=function(a){return console.log("Views:SearchBar:Search",a,this.$el),this.model.set("query",a),this.$magicField.focus(),this.searchSubmit()},c}(Backbone.View),App.Views.IndexView=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.initialize=function(a){return console.log("Views:IndexView::Initing...",this),this.options=a||{},_.bindAll(this,"template","resultsEl","render")},c.prototype.searchEl=function(){var a;return a=$(".searchContainer",this.$el),console.log("Views:IndexView::SearchEl",a),a},c.prototype.catalogEl=function(){var a;return a=$(".catalogContainer",this.$el),console.log("Views:IndexView::CatalogEl",a),a},c.prototype.resultsEl=function(){var a;return a=$(".results",this.$el),console.log("Views:IndexView::ResultsEl",a),a},c.prototype.template=function(){return _.template(App.Config.$indexTemplateDOM.html(),{})},c.prototype.render=function(){return console.log("Views:IndexView::render",this),this.setElement($(this.template())),this},c}(Backbone.View),App.Views.FullView=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.initialize=function(a){var b;return console.log("Views:FullView::Initing..."),this.options=a||{},_.bindAll(this,"onScroll","onScrollNotTop"),this.$bodyEl=$(this.el.document.body),this.onScroll(),b=$("html, body"),b.bind("scroll mousedown DOMMouseScroll mousewheel keyup",function(){return b.stop()})},c.prototype.events={scroll:"onScroll"},c.prototype.setSearchBarView=function(a){return this.$magicFieldEl=null!=a?a.$magicField:void 0,console.log("Views:FullView::setSearchView",this.$magicFieldEl)},c.prototype.onScrollNotTop=function(){var a;return console.log("Views:FullView::onScrollNotTop"),(a=this._onScrollNotTop||(this._onScrollNotTop=_.throttle(function(a){return function(){var b;return console.log("+++ Views:FullView::onScrollNotTop"),a.$bodyEl.hasClass("scrolledTop")?(a.$bodyEl.removeClass("scrolledTop"),null!=(b=a.$magicFieldEl)?b.blur():void 0):void 0}}(this),100)))()},c.prototype.onScroll=function(){var a;return a=this.$el.scrollTop(),a%2?void 0:a>150?this.onScrollNotTop():this.$bodyEl.addClass("scrolledTop")},c}(Backbone.View),App.Router.RootRouter=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.routes={"":"index"},c.prototype.index=function(){return this.doCleanUp(),App.Live.FullView=new App.Views.FullView({el:window}),App.Live.IndexView=new App.Views.IndexView({fullView:App.Live.FullView}),this.doRender(App.Live.IndexView),App.Live.RootSearchBarModel=new App.Models.SearchBar,App.Live.RootSearchBarView=new App.Views.SearchBar({el:App.Live.IndexView.searchEl(),model:App.Live.RootSearchBarModel}),App.Live.FullView.setSearchBarView(App.Live.RootSearchBarView),App.Live.RootSearchResultsView=new App.Views.SearchResults({el:App.Live.IndexView.resultsEl(),searchBarModel:App.Live.RootSearchBarModel}),App.Live.CatalogCollection=new App.Collections.Catalog([],{model:App.Models.CatalogMovie}),App.Live.CatalogView=new App.Views.Catalog({el:App.Live.IndexView.catalogEl(),catalogCollection:App.Live.CatalogCollection,catalogMovieViewClass:App.Views.CatalogMovie,searchBarView:App.Live.RootSearchBarView,extendedMetadataModelClass:App.Models.CatalogMovieExtendedMetadata})},c.prototype.doCleanUp=function(){return $("body").empty()},c.prototype.doRender=function(a){return $("body").append(a.render().el)},c.prototype.initialize=function(a){return this.options=a||{}},c}(Backbone.Router),App.Live.Router-new App.Router.RootRouter,Backbone.history.start()}).call(this);